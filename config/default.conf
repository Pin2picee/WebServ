# ============================================
# WEBSERV CONFIGURATION FILE
# ============================================

# ------------------------------
# SERVER 1 : main site
# ------------------------------
server {
	# Listen address and port
	listen 127.0.0.1:8080;
	server_name localhost www.localhost;

	# Site root directory
	root config/www;
	index index.html index.htm;

	# Maximum client request body size
	client_max_body_size 10M;

	# Custom error pages
	error_page 201 /errors/201.html;
	error_page 204 /errors/204.html;
	error_page 400 /errors/400.html;
	error_page 401 /errors/401.html;
	error_page 403 /errors/403.html;
	error_page 404 /errors/404.html;
	error_page 405 /errors/405.html;
	error_page 413 /errors/413.html;
	error_page 418 /errors/418.html;
	error_page 500 /errors/500.html;
	error_page 501 /errors/501.html;
	error_page 502 /errors/502.html;
	error_page 503 /errors/503.html;

	# --------------------------
	# LOCATION : /
	# --------------------------
	location / {
		methods GET POST;
		root config/www;
		index index.html;
		autoindex off;
	}

	# --------------------------
	# LOCATION : /uploads
	# --------------------------
	location /uploads {
		methods POST;
		upload_enabled on;
		upload_store config/www/uploads;
		autoindex on;
	}

	# --------------------------
	# LOCATION : /redirect
	# --------------------------
	location /redirect {
		methods GET;
		return 301 http://127.0.0.1:8081;
	}

	# --------------------------
	# LOCATION : /cgi-bin
	# --------------------------
	location /cgi-bin {
		methods GET POST;
		cgi_extension .py;
		cgi_path /usr/bin/python3;
		cgi on;
		root config/www;
	}
}

# ------------------------------
# SERVER 2 : personal blog
# ------------------------------
server {
	listen 127.0.0.1:8081;
	server_name blog.local myblog.local;

	root config/www;
	index home.html;
	client_max_body_size 5M;

	error_page 201 /errors/201.html;
	error_page 204 /errors/204.html;
	error_page 400 /errors/400.html;
	error_page 401 /errors/401.html;
	error_page 403 /errors/403.html;
	error_page 404 /errors/404.html;
	error_page 405 /errors/405.html;
	error_page 413 /errors/413.html;
	error_page 418 /errors/418.html;
	error_page 500 /errors/500.html;
	error_page 501 /errors/501.html;
	error_page 502 /errors/502.html;
	error_page 503 /errors/503.html;

	# --------------------------
	# LOCATION : /
	# --------------------------
	location / {
		methods GET;
		root config/www;
		index home.html;
		autoindex off;
	}

	# --------------------------
	# LOCATION : /images
	# --------------------------
	location /images {
		methods GET;
		root config/www/images;
		autoindex on;
	}

	# --------------------------
	# LOCATION : /contact
	# --------------------------
	location /contact {
		methods GET POST;
		root config/www/forms;
		index contact.html;
	}

	# --------------------------
	# LOCATION : /cgi
	# --------------------------
	location /cgi {
		methods POST;
		cgi_extension .php;
		cgi_path /usr/bin/php-cgi;
		root config/www/cgi;
	}
}

# ------------------------------
# SERVER 3 : dedicated upload site
# ------------------------------
server {
	listen 0.0.0.0:8082;
	server_name upload.local;

	root config/www;
	index index.html;

	client_max_body_size 20M;

	error_page 201 /errors/201.html;
	error_page 204 /errors/204.html;
	error_page 400 /errors/400.html;
	error_page 401 /errors/401.html;
	error_page 403 /errors/403.html;
	error_page 404 /errors/404.html;
	error_page 405 /errors/405.html;
	error_page 413 /errors/413.html;
	error_page 418 /errors/418.html;
	error_page 500 /errors/500.html;
	error_page 501 /errors/501.html;
	error_page 502 /errors/502.html;
	error_page 503 /errors/503.html;

	# --------------------------
	# LOCATION : /
	# --------------------------
	location / {
		methods GET;
		index index.html;
		autoindex off;
	}

	# --------------------------
	# LOCATION : /files
	# --------------------------
	location /files {
		methods GET POST DELETE;
		upload_enabled on;
		upload_store config/www/uploads;
		autoindex on;
	}
}
